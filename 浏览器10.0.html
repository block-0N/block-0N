<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç®€çº¦å¤§æ°”å¯¼èˆªä¸»é¡µ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- å›¾æ ‡æ ·å¼ä¼˜åŒ–ï¼šç»Ÿä¸€å°ºå¯¸å’Œå¯¹é½æ–¹å¼ -->
    <style>
        .fa {
            display: inline-block;
            font-family: Arial, sans-serif;
            font-weight: normal;
            font-style: normal;
            text-align: center;
            font-size: 1.1em; /* ç»Ÿä¸€å›¾æ ‡åŸºç¡€å°ºå¯¸ */
            line-height: 1;
            width: 1.2em; /* å›ºå®šå®½åº¦ä¿è¯å¯¹é½ */
        }
        /* å¤©æ°”å›¾æ ‡ç‰¹æ®Šè°ƒæ•´ */
        .weather-icon {
            font-size: 1.8em !important;
            width: auto !important;
        }
        /* é¡µé¢ä¸­ç”¨åˆ°çš„æ‰€æœ‰å›¾æ ‡æ›¿æ¢ä¸ºEmoji */
        .fa-calendar-plus-o:before { content: "ğŸ“…"; }
        .fa-birthday-cake:before { content: "ğŸ‚"; }
        .fa-plus-circle:before { content: "â•"; }
        .fa-search:before { content: "ğŸ”"; }
        .fa-refresh:before { content: "â™»ï¸"; }
        .fa-pencil:before { content: "âœï¸"; }
        .fa-moon-o:before { content: "ğŸŒ™"; }
        .fa-sun-o:before { content: "â˜€ï¸"; }
        .fa-cloud:before { content: "â˜ï¸"; }
        .fa-cloudy:before { content: "â›…"; }
        .fa-tint:before { content: "ğŸ’§"; }
        .fa-smog:before { content: "ğŸŒ«ï¸"; }
        .fa-bolt:before { content: "âš¡"; }
        .fa-cloud-sun:before { content: "â›…"; }
        .fa-commenting-o:before { content: "ğŸ’¬"; }
        .fa-book:before { content: "ğŸ“–"; }
        .fa-play-circle:before { content: "â–¶ï¸"; }
        .fa-envelope:before { content: "âœ‰ï¸"; }
        .fa-shopping-cart:before { content: "ğŸ›’"; }
        .fa-video-camera:before { content: "ğŸ“¹"; }
        .fa-music:before { content: "ğŸµ"; }
        .fa-gamepad:before { content: "ğŸ®"; }
        .fa-globe:before { content: "ğŸŒ"; }
    </style>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#2563eb',
                        secondary: '#475569',
                        accent: '#8b5cf6',
                        dark: '#0f172a',
                        light: '#f1f5f9'
                    },
                    fontFamily: {
                        inter: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
    </script>

    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .text-glow {
                text-shadow: 0 0 15px rgba(37, 99, 235, 0.2);
            }
            .card-hover {
                transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            }
            .card-hover:hover {
                transform: translateY(-4px) scale(1.02);
                box-shadow: 0 12px 24px -8px rgba(0, 0, 0, 0.15);
            }
            .bg-dynamic {
                background: linear-gradient(135deg, #f5f7fa 0%, #e4eaf5 100%);
                background-size: 400% 400%;
                animation: gradient 15s ease infinite;
            }
            @keyframes gradient {
                0% { background-position: 0% 50%; }
                50% { background-position: 100% 50%; }
                100% { background-position: 0% 50%; }
            }
            .search-focus {
                @apply border-primary ring-2 ring-primary/20;
            }
            .festival-tag {
                @apply px-3 py-1 rounded-full text-sm font-medium bg-red-100 text-red-600;
            }
            .reminder-tag {
                @apply px-3 py-1 rounded-full text-sm font-medium bg-pink-100 text-pink-600 animate-pulse;
            }
            /* å¤©æ°”å¡ç‰‡ä¼˜åŒ–æ ·å¼ */
            .weather-card {
                @apply w-full max-w-2xl mb-8 bg-white/80 backdrop-blur-sm rounded-xl shadow-md p-5 flex items-center justify-between transition-all hover:shadow-lg;
            }
            /* å¿«æ·å¯¼èˆªå¡ç‰‡ç»Ÿä¸€å°ºå¯¸ */
            .nav-card {
                @apply flex flex-col items-center justify-center p-5 rounded-2xl bg-white/90 card-hover shadow-md h-full;
            }
        }
    </style>
</head>
<body class="bg-dynamic min-h-screen flex flex-col items-center justify-center p-4 font-inter">
    <!-- é¡¶éƒ¨åŠŸèƒ½åŒºï¼ˆä¼˜åŒ–ï¼šè°ƒæ•´æŒ‰é’®é¡ºåºå’Œé—´è·ï¼‰ -->
    <div class="w-full max-w-5xl mx-auto mb-6 flex justify-end gap-3 flex-wrap">
        <button 
            id="add-custom-date-btn"
            class="px-4 py-2 rounded-lg bg-white/80 backdrop-blur-sm shadow-md hover:shadow-lg transition-shadow flex items-center gap-2"
        >
            <i class="fa fa-calendar-plus-o text-primary"></i>
            <span class="text-sm font-medium">è‡ªå®šä¹‰æ—¥æœŸ</span>
        </button>
        <button 
            id="add-birthday-btn"
            class="px-4 py-2 rounded-lg bg-white/80 backdrop-blur-sm shadow-md hover:shadow-lg transition-shadow flex items-center gap-2"
        >
            <i class="fa fa-birthday-cake text-pink-500"></i>
            <span class="text-sm font-medium">æ·»åŠ ç”Ÿæ—¥</span>
        </button>
        <button 
            id="theme-toggle"
            class="px-4 py-2 rounded-lg bg-white/80 backdrop-blur-sm shadow-md hover:shadow-lg transition-shadow flex items-center gap-2"
         >
            <i class="fa fa-moon-o text-slate-600"></i>
            <span class="text-sm font-medium">æ·±è‰²æ¨¡å¼</span>
        </button>
    </div>

    <!-- ä¸»å®¹å™¨ -->
    <div class="w-full max-w-5xl mx-auto flex flex-col items-center">
        <!-- é—®å€™è¯­ -->
        <div id="greeting" class="text-secondary text-lg md:text-xl mb-4 text-center"></div>
        
        <!-- æ—¶é—´æ˜¾ç¤ºåŒºåŸŸï¼ˆä¼˜åŒ–ï¼šå†…è¾¹è·å’Œé˜´å½±ï¼‰ -->
        <div class="mb-6 text-center bg-white/80 backdrop-blur-sm rounded-2xl p-6 md:p-8 shadow-lg">
            <div id="digital-clock" class="text-[clamp(3.5rem,10vw,7rem)] font-bold text-dark text-glow mb-3"></div>
            <div id="date-info" class="text-[clamp(1rem,2vw,1.3rem)] text-secondary flex flex-wrap justify-center gap-x-4 gap-y-2 mb-3">
                <span id="week-day" class="px-2 py-1 bg-primary/10 rounded-full"></span>
                <span id="gregorian-date" class="px-2 py-1 bg-secondary/10 rounded-full"></span>
                <span id="lunar-date" class="px-2 py-1 bg-accent/10 text-accent rounded-full"></span>
            </div>
            <!-- èŠ‚æ—¥/æé†’æ˜¾ç¤ºåŒºåŸŸ -->
            <div id="festival-info" class="festival-tag"></div>
        </div>

        <!-- å¤©æ°”å¡ç‰‡ï¼ˆæ ¸å¿ƒä¼˜åŒ–ï¼šå®æ—¶å¤©æ°” + å¸ƒå±€ç¾åŒ–ï¼‰ -->
        <div class="weather-card">
            <div class="flex items-center gap-4">
                <i id="weather-icon" class="fa fa-sun-o text-yellow-500 weather-icon"></i>
                <div>
                    <!-- ä¿®æ”¹ï¼šå°†åŸè‹±æ–‡ä½ç½®æ”¹ä¸ºæ˜¾ç¤ºå½“å‰å®šä½ -->
                    <div id="weather-city" class="font-medium text-dark flex items-center gap-2 text-base">
                        <span id="location-display">å®šä½ä¸­...</span>
                        <button id="change-location-btn" class="text-xs text-primary hover:text-accent transition-colors">
                            <i class="fa fa-pencil"></i> ä¿®æ”¹
                        </button>
                    </div>
                    <div class="flex items-center gap-2 mt-1">
                        <div id="weather-temp" class="text-lg font-medium text-dark">--Â°C</div>
                        <div id="weather-condition" class="text-sm text-secondary">åŠ è½½ä¸­...</div>
                    </div>
                    <div id="weather-detail" class="text-xs text-secondary mt-1">
                        æ¹¿åº¦ï¼š--% | é£åŠ›ï¼š--çº§
                    </div>
                </div>
            </div>
            <div class="text-sm text-secondary flex flex-col items-end">
                <div id="weather-update-time">
                    <i class="fa fa-refresh mr-1"></i>æ›´æ–°ä¸­...
                </div>
                <div class="text-xs mt-1 text-gray-400" id="weather-tips"></div>
            </div>
        </div>

        <!-- æœç´¢æ¡†åŒºåŸŸï¼ˆä¼˜åŒ–ï¼šè°ƒæ•´å†…è¾¹è·ï¼‰ -->
        <div class="w-full max-w-2xl mb-8 relative">
            <input 
                type="text" 
                id="search-input"
                placeholder="è¾“å…¥æœç´¢å†…å®¹ï¼ˆæ”¯æŒç™¾åº¦/è°·æ­Œåˆ‡æ¢ï¼‰..." 
                class="w-full py-4 px-6 pr-20 rounded-full border border-slate-200 focus:search-focus outline-none transition-all bg-white/90 shadow-md"
            >
            <select id="search-engine" class="absolute right-16 top-1/2 -translate-y-1/2 bg-transparent border-0 text-secondary focus:outline-none text-sm">
                <option value="baidu">ç™¾åº¦</option>
                <option value="google">è°·æ­Œ</option>
            </select>
            <button 
                id="search-btn"
                class="absolute right-3 top-1/2 -translate-y-1/2 text-secondary hover:text-primary transition-colors p-1 rounded-full hover:bg-primary/10"
            >
                <i class="fa fa-search text-xl"></i>
            </button>
        </div>

        <!-- å¿«æ·å¯¼èˆªåŒºåŸŸï¼ˆæ ¸å¿ƒä¼˜åŒ–ï¼šè°ƒæ•´å›¾æ ‡å¤§å°ã€æ’åˆ—é¡ºåºã€ç»Ÿä¸€å¡ç‰‡å°ºå¯¸ï¼‰ -->
        <div class="w-full grid grid-cols-2 sm:grid-cols-4 md:grid-cols-6 gap-4 md:gap-5">
            <!-- è±†åŒ…å¿«æ·å…¥å£ï¼ˆä¼˜å…ˆæ˜¾ç¤ºï¼‰ -->
            <a 
                href="https://www.doubao.com" 
                target="_blank" 
                class="nav-card"
            >
                <div class="w-12 h-12 md:w-14 md:h-14 rounded-full bg-primary/10 flex items-center justify-center mb-2">
                    <i class="fa fa-commenting-o text-primary text-xl md:text-2xl"></i>
                </div>
                <span class="text-sm font-medium text-dark">è±†åŒ…</span>
            </a>
            
            <!-- Bç«™ -->
            <a 
                href="https://www.bilibili.com" 
                target="_blank" 
                class="nav-card"
            >
                <div class="w-12 h-12 md:w-14 md:h-14 rounded-full bg-pink-100 flex items-center justify-center mb-2">
                    <i class="fa fa-play-circle text-pink-600 text-xl md:text-2xl"></i>
                </div>
                <span class="text-sm font-medium text-dark">Bç«™</span>
            </a>
            
            <!-- æ·»åŠ ç½‘ç«™å¿«æ·å…¥å£ï¼ˆä¼˜åŒ–æ ·å¼ï¼‰ -->
            <button 
                id="add-site-btn"
                class="nav-card border-2 border-dashed border-slate-200 hover:border-primary"
            >
                <div class="w-12 h-12 md:w-14 md:h-14 rounded-full bg-slate-100 flex items-center justify-center mb-2">
                    <i class="fa fa-plus-circle text-slate-400 hover:text-primary text-xl md:text-2xl transition-colors"></i>
                </div>
                <span class="text-sm font-medium text-slate-500 hover:text-primary transition-colors">æ·»åŠ ç½‘ç«™</span>
            </button>
        </div>
    </div>

    <script>
        // ==================== æ ¸å¿ƒåŠŸèƒ½ï¼šç²¾å‡†å†œå†è®¡ç®— ====================
        class LunarConverter {
            static LUNAR_NEW_YEAR = {
                2024: [2, 10], 2025: [1, 29], 2026: [2, 17], 2027: [2, 6], 2028: [1, 26],
                2029: [2, 13], 2030: [2, 3], 2031: [1, 23], 2032: [2, 11], 2033: [1, 31],
                2034: [2, 19], 2035: [2, 8], 2036: [1, 28], 2037: [2, 15], 2038: [2, 4],
                2039: [1, 24], 2040: [2, 12], 2041: [2, 1], 2042: [1, 22], 2043: [2, 10],
                2044: [1, 30], 2045: [2, 17], 2046: [2, 6], 2047: [1, 26], 2048: [2, 14],
                2049: [2, 2], 2050: [1, 23], 2023: [1, 22], 2022: [2, 1], 2021: [2, 12],
                2020: [1, 25], 2019: [2, 5], 2018: [2, 16], 2017: [1, 28], 2016: [2, 8],
                2015: [2, 19], 2014: [1, 31], 2013: [2, 10], 2012: [1, 23], 2011: [2, 3],
                2010: [2, 14], 2009: [1, 26], 2008: [2, 7], 2007: [2, 18], 2006: [1, 29],
                2005: [2, 9], 2004: [1, 22], 2003: [2, 1], 2002: [2, 12], 2001: [1, 24],
                2000: [2, 5], 1999: [2, 16], 1998: [1, 28], 1997: [2, 7], 1996: [2, 19],
                1995: [1, 31], 1994: [2, 10], 1993: [1, 23], 1992: [2, 4], 1991: [2, 15],
                1990: [1, 27], 1989: [2, 6], 1988: [2, 17], 1987: [1, 29], 1986: [2, 9],
                1985: [2, 20], 1984: [2, 2], 1983: [2, 13], 1982: [1, 25], 1981: [2, 5],
                1980: [2, 16], 1979: [1, 28], 1978: [2, 7], 1977: [2, 18], 1976: [1, 31]
            };

            static LUNAR_MONTH_DAYS = [30,29,30,29,30,29,30,30,29,30,29,30];
            static ZODIACS = ['é¼ ','ç‰›','è™','å…”','é¾™','è›‡','é©¬','ç¾Š','çŒ´','é¸¡','ç‹—','çŒª'];
            static LUNAR_MONTHS = ['æ­£æœˆ','äºŒæœˆ','ä¸‰æœˆ','å››æœˆ','äº”æœˆ','å…­æœˆ','ä¸ƒæœˆ','å…«æœˆ','ä¹æœˆ','åæœˆ','å†¬æœˆ','è…Šæœˆ'];
            static LUNAR_DAYS = ['åˆä¸€','åˆäºŒ','åˆä¸‰','åˆå››','åˆäº”','åˆå…­','åˆä¸ƒ','åˆå…«','åˆä¹','åˆå',
                               'åä¸€','åäºŒ','åä¸‰','åå››','åäº”','åå…­','åä¸ƒ','åå…«','åä¹','äºŒå',
                               'å»¿ä¸€','å»¿äºŒ','å»¿ä¸‰','å»¿å››','å»¿äº”','å»¿å…­','å»¿ä¸ƒ','å»¿å…«','å»¿ä¹','ä¸‰å'];

            static getLunarDate(solarDate) {
                const year = solarDate.getFullYear();
                const month = solarDate.getMonth() + 1;
                const day = solarDate.getDate();

                const ny = this.LUNAR_NEW_YEAR[year] || [2, 1];
                const nyMonth = ny[0];
                const nyDay = ny[1];

                let lunarYear = year;
                let lunarMonth = 1;
                let lunarDay = 1;

                if (month < nyMonth || (month === nyMonth && day < nyDay)) {
                    lunarYear -= 1;
                    const lastNy = this.LUNAR_NEW_YEAR[lunarYear] || [2, 1];
                    const daysPassed = this.getDaysBetween(
                        new Date(lunarYear, lastNy[0]-1, lastNy[1]),
                        solarDate
                    );
                    const lunarDate = this.calcLunarDayFromDays(daysPassed);
                    lunarMonth = lunarDate.month;
                    lunarDay = lunarDate.day;
                } else {
                    const daysPassed = this.getDaysBetween(
                        new Date(year, nyMonth-1, nyDay),
                        solarDate
                    );
                    const lunarDate = this.calcLunarDayFromDays(daysPassed);
                    lunarMonth = lunarDate.month;
                    lunarDay = lunarDate.day;
                }

                const zodiac = this.ZODIACS[(lunarYear - 1900) % 12];
                
                return {
                    year: lunarYear,
                    month: this.LUNAR_MONTHS[lunarMonth - 1],
                    day: this.LUNAR_DAYS[lunarDay - 1],
                    zodiac: zodiac,
                    fullText: `${lunarYear}å¹´(${zodiac}) ${this.LUNAR_MONTHS[lunarMonth - 1]}${this.LUNAR_DAYS[lunarDay - 1]}`,
                    monthNum: lunarMonth,
                    dayNum: lunarDay
                };
            }

            static getSolarFromLunar(targetYear, lunarMonth, lunarDay) {
                const ny = this.LUNAR_NEW_YEAR[targetYear] || [2, 1];
                const newYear = new Date(targetYear, ny[0]-1, ny[1]);
                
                let totalDays = 0;
                for (let i = 0; i < lunarMonth - 1; i++) {
                    totalDays += this.LUNAR_MONTH_DAYS[i];
                }
                totalDays += lunarDay - 1;
                
                const solarDate = new Date(newYear);
                solarDate.setDate(solarDate.getDate() + totalDays);
                
                return {
                    year: solarDate.getFullYear(),
                    month: solarDate.getMonth() + 1,
                    day: solarDate.getDate()
                };
            }

            static getDaysBetween(date1, date2) {
                const oneDay = 24 * 60 * 60 * 1000;
                const diffTime = Math.abs(date2 - date1);
                return Math.floor(diffTime / oneDay);
            }

            static calcLunarDayFromDays(days) {
                let month = 1;
                let day = days + 1;
                
                for (let i = 0; i < this.LUNAR_MONTH_DAYS.length; i++) {
                    const monthDays = this.LUNAR_MONTHS[i];
                    if (day > monthDays) {
                        day -= monthDays;
                        month++;
                    } else {
                        break;
                    }
                }

                return { month, day };
            }
        }

        // ==================== åŸå¸‚åç§°ä¸­è‹±æ–‡æ˜ å°„ï¼ˆæ ¸å¿ƒä¿®å¤ï¼‰ ====================
        const CITY_NAME_MAP = {
            'Beijing': 'åŒ—äº¬å¸‚',
            'Shanghai': 'ä¸Šæµ·å¸‚',
            'Tianjin': 'å¤©æ´¥å¸‚',
            'Chongqing': 'é‡åº†å¸‚',
            'Guangzhou': 'å¹¿å·å¸‚',
            'Shenzhen': 'æ·±åœ³å¸‚',
            'Hangzhou': 'æ­å·å¸‚',
            'Nanjing': 'å—äº¬å¸‚',
            'Chengdu': 'æˆéƒ½å¸‚',
            'Wuhan': 'æ­¦æ±‰å¸‚',
            'Xi\'an': 'è¥¿å®‰å¸‚',
            'Changsha': 'é•¿æ²™å¸‚',
            'Qingdao': 'é’å²›å¸‚',
            'Shenyang': 'æ²ˆé˜³å¸‚',
            'Harbin': 'å“ˆå°”æ»¨å¸‚',
            'Urumqi': 'ä¹Œé²æœ¨é½å¸‚',
            'Lhasa': 'æ‹‰è¨å¸‚',
            'Kunming': 'æ˜†æ˜å¸‚',
            'Guiyang': 'è´µé˜³å¸‚',
            'Nanning': 'å—å®å¸‚',
            'Hefei': 'åˆè‚¥å¸‚',
            'Nanchang': 'å—æ˜Œå¸‚',
            'Jinan': 'æµå—å¸‚',
            'Zhengzhou': 'éƒ‘å·å¸‚',
            'Taiyuan': 'å¤ªåŸå¸‚',
            'Shijiazhuang': 'çŸ³å®¶åº„å¸‚',
            'Hohhot': 'å‘¼å’Œæµ©ç‰¹å¸‚',
            'Lanzhou': 'å…°å·å¸‚',
            'Xining': 'è¥¿å®å¸‚',
            'Yinchuan': 'é“¶å·å¸‚',
            'Fuzhou': 'ç¦å·å¸‚',
            'Xiamen': 'å¦é—¨å¸‚',
            'Taipei': 'å°åŒ—å¸‚',
            'Hong Kong': 'é¦™æ¸¯',
            'Macau': 'æ¾³é—¨',
            'Suzhou': 'è‹å·å¸‚',
            'Wuxi': 'æ— é”¡å¸‚',
            'Ningbo': 'å®æ³¢å¸‚',
            'Wenzhou': 'æ¸©å·å¸‚',
            'Dongguan': 'ä¸œèå¸‚',
            'Foshan': 'ä½›å±±å¸‚',
            'Zhongshan': 'ä¸­å±±å¸‚',
            'Zhuhai': 'ç æµ·å¸‚',
            'Huizhou': 'æƒ å·å¸‚',
            'Jiangmen': 'æ±Ÿé—¨å¸‚',
            'Shantou': 'æ±•å¤´å¸‚',
            'Qingdao': 'é’å²›å¸‚',
            'Yantai': 'çƒŸå°å¸‚',
            'Weihai': 'å¨æµ·å¸‚',
            'Dalian': 'å¤§è¿å¸‚',
            'Qingdao': 'é’å²›å¸‚',
            'Sanya': 'ä¸‰äºšå¸‚',
            'Haikou': 'æµ·å£å¸‚',
            'Wuxi': 'æ— é”¡å¸‚',
            'Changzhou': 'å¸¸å·å¸‚',
            'Yangzhou': 'æ‰¬å·å¸‚',
            'Zhenjiang': 'é•‡æ±Ÿå¸‚',
            'Nantong': 'å—é€šå¸‚',
            'Taizhou': 'å°å·å¸‚',
            'Jiaxing': 'å˜‰å…´å¸‚',
            'Huzhou': 'æ¹–å·å¸‚',
            'Shaoxing': 'ç»å…´å¸‚',
            'Zhoushan': 'èˆŸå±±å¸‚',
            // é€šç”¨è½¬æ¢ï¼ˆç§»é™¤åç¼€ï¼‰
            ' City': '',
            ' Shi': '',
            ' Prefecture': ''
        };

        // è½¬æ¢åŸå¸‚åä¸ºä¸­æ–‡
        function convertToChineseCityName(cityName) {
            if (!cityName) return 'åŒ—äº¬å¸‚';
            
            // å…ˆè½¬æ¢å·²çŸ¥çš„è‹±æ–‡åŸå¸‚å
            let chineseName = cityName;
            Object.keys(CITY_NAME_MAP).forEach(key => {
                chineseName = chineseName.replace(key, CITY_NAME_MAP[key]);
            });
            
            // å¦‚æœè¿˜æ˜¯è‹±æ–‡ï¼Œå°è¯•æ‹¼éŸ³è½¬ä¸­æ–‡ï¼ˆç®€å•åŒ¹é…ï¼‰
            const pinyinMap = {
                'beijing': 'åŒ—äº¬å¸‚',
                'shanghai': 'ä¸Šæµ·å¸‚',
                'guangzhou': 'å¹¿å·å¸‚',
                'shenzhen': 'æ·±åœ³å¸‚',
                'hangzhou': 'æ­å·å¸‚',
                'chengdu': 'æˆéƒ½å¸‚',
                'wuhan': 'æ­¦æ±‰å¸‚',
                'nanjing': 'å—äº¬å¸‚',
                'chongqing': 'é‡åº†å¸‚',
                'tianjin': 'å¤©æ´¥å¸‚'
            };
            
            const lowerName = chineseName.toLowerCase().trim();
            if (pinyinMap[lowerName]) {
                chineseName = pinyinMap[lowerName];
            }
            
            // æœ€åæ£€æŸ¥æ˜¯å¦åŒ…å«ä¸­æ–‡å­—ç¬¦ï¼Œæ²¡æœ‰åˆ™è¿”å›é»˜è®¤å€¼
            const hasChinese = /[\u4e00-\u9fa5]/.test(chineseName);
            if (!hasChinese) {
                chineseName = 'åŒ—äº¬å¸‚';
            }
            
            return chineseName;
        }

        // ==================== ç”Ÿæ—¥ç®¡ç†åŠŸèƒ½ ====================
        function getBirthdays() {
            const birthdays = localStorage.getItem('birthdays');
            return birthdays ? JSON.parse(birthdays) : [];
        }

        function saveBirthday(birthday) {
            const birthdays = getBirthdays();
            birthdays.push(birthday);
            localStorage.setItem('birthdays', JSON.stringify(birthdays));
        }

        function checkBirthdayReminder(today) {
            const birthdays = getBirthdays();
            if (birthdays.length === 0) return null;
            
            const todaySolar = {
                month: today.getMonth() + 1,
                day: today.getDate()
            };
            
            const todayLunar = LunarConverter.getLunarDate(today);
            
            for (const birthday of birthdays) {
                if (birthday.type === 'solar' && 
                    birthday.month === todaySolar.month && 
                    birthday.day === todaySolar.day) {
                    return `${birthday.name}çš„å…¬å†ç”Ÿæ—¥ ğŸ‚`;
                }
                
                if (birthday.type === 'lunar') {
                    if (birthday.lunarMonth === todayLunar.monthNum && 
                        birthday.lunarDay === todayLunar.dayNum) {
                        return `${birthday.name}çš„å†œå†ç”Ÿæ—¥ ğŸ‚`;
                    }
                }
            }
            
            return null;
        }

        function initAddBirthdayBtn() {
            const addBtn = document.getElementById('add-birthday-btn');
            
            addBtn.addEventListener('click', () => {
                const name = prompt('è¯·è¾“å…¥å¯¿æ˜Ÿå§“åï¼š');
                if (!name) return;
                
                const type = prompt('è¯·é€‰æ‹©ç”Ÿæ—¥ç±»å‹ï¼ˆè¾“å…¥ 1 è¡¨ç¤ºå…¬å†ï¼Œ2 è¡¨ç¤ºå†œå†ï¼‰ï¼š');
                if (!['1', '2'].includes(type)) {
                    alert('è¯·è¾“å…¥ 1 æˆ– 2 é€‰æ‹©ç”Ÿæ—¥ç±»å‹ï¼');
                    return;
                }
                const birthdayType = type === '1' ? 'solar' : 'lunar';
                
                if (birthdayType === 'solar') {
                    const month = prompt('è¯·è¾“å…¥å…¬å†æœˆä»½ï¼ˆ1-12ï¼‰ï¼š');
                    if (!month || month < 1 || month > 12) {
                        alert('æœˆä»½è¾“å…¥é”™è¯¯ï¼');
                        return;
                    }
                    const day = prompt('è¯·è¾“å…¥å…¬å†æ—¥æœŸï¼ˆ1-31ï¼‰ï¼š');
                    if (!day || day < 1 || day > 31) {
                        alert('æ—¥æœŸè¾“å…¥é”™è¯¯ï¼');
                        return;
                    }
                    
                    saveBirthday({
                        name,
                        type: 'solar',
                        month: parseInt(month),
                        day: parseInt(day),
                        createTime: new Date().toISOString()
                    });
                    alert(`${name}çš„å…¬å†ç”Ÿæ—¥ï¼ˆ${month}æœˆ${day}æ—¥ï¼‰å·²æ·»åŠ ï¼Œæ¯å¹´è‡ªåŠ¨æé†’ï¼`);
                } else {
                    const lunarMonth = prompt('è¯·è¾“å…¥å†œå†æœˆä»½ï¼ˆ1-12ï¼Œ1=æ­£æœˆï¼Œ12=è…Šæœˆï¼‰ï¼š');
                    if (!lunarMonth || lunarMonth < 1 || lunarMonth > 12) {
                        alert('å†œå†æœˆä»½è¾“å…¥é”™è¯¯ï¼');
                        return;
                    }
                    const lunarDay = prompt('è¯·è¾“å…¥å†œå†æ—¥æœŸï¼ˆ1-30ï¼‰ï¼š');
                    if (!lunarDay || lunarDay < 1 || lunarDay > 30) {
                        alert('å†œå†æ—¥æœŸè¾“å…¥é”™è¯¯ï¼');
                        return;
                    }
                    
                    saveBirthday({
                        name,
                        type: 'lunar',
                        lunarMonth: parseInt(lunarMonth),
                        lunarDay: parseInt(lunarDay),
                        createTime: new Date().toISOString()
                    });
                    alert(`${name}çš„å†œå†ç”Ÿæ—¥ï¼ˆ${LunarConverter.LUNAR_MONTHS[parseInt(lunarMonth)-1]}${LunarConverter.LUNAR_DAYS[parseInt(lunarDay)-1]}ï¼‰å·²æ·»åŠ ï¼Œæ¯å¹´è‡ªåŠ¨æé†’ï¼`);
                }
            });
        }

        // ==================== èŠ‚æ—¥/è‡ªå®šä¹‰æ—¥æœŸåŠŸèƒ½ ====================
        const FESTIVALS = {
            "1-1": "å…ƒæ—¦",
            "2-14": "æƒ…äººèŠ‚",
            "3-8": "å¦‡å¥³èŠ‚",
            "3-12": "æ¤æ ‘èŠ‚",
            "4-1": "æ„šäººèŠ‚",
            "5-1": "åŠ³åŠ¨èŠ‚",
            "5-4": "é’å¹´èŠ‚",
            "6-1": "å„¿ç«¥èŠ‚",
            "7-1": "å»ºå…šèŠ‚",
            "8-1": "å»ºå†›èŠ‚",
            "9-10": "æ•™å¸ˆèŠ‚",
            "10-1": "å›½åº†èŠ‚",
            "12-25": "åœ£è¯èŠ‚",
            "lunar-1-1": "æ˜¥èŠ‚",
            "lunar-1-15": "å…ƒå®µèŠ‚",
            "lunar-5-5": "ç«¯åˆèŠ‚",
            "lunar-8-15": "ä¸­ç§‹èŠ‚",
            "lunar-9-9": "é‡é˜³èŠ‚"
        };

        function getCustomDates() {
            const customDates = localStorage.getItem('customDates');
            return customDates ? JSON.parse(customDates) : {};
        }

        function saveCustomDate(dateKey, content) {
            const customDates = getCustomDates();
            customDates[dateKey] = content;
            localStorage.setItem('customDates', JSON.stringify(customDates));
        }

        function getTodayFestival(solarDate, lunarDate) {
            const year = solarDate.getFullYear();
            const month = solarDate.getMonth() + 1;
            const day = solarDate.getDate();
            
            const birthdayReminder = checkBirthdayReminder(solarDate);
            if (birthdayReminder) {
                document.getElementById('festival-info').className = 'reminder-tag';
                return birthdayReminder;
            }
            
            document.getElementById('festival-info').className = 'festival-tag';
            
            const solarKey = `${month}-${day}`;
            if (FESTIVALS[solarKey]) {
                return FESTIVALS[solarKey];
            }
            
            const lunarKey = `lunar-${lunarDate.monthNum}-${lunarDate.dayNum}`;
            if (FESTIVALS[lunarKey]) {
                return FESTIVALS[lunarKey];
            }
            
            const customDates = getCustomDates();
            const customKey = `${year}-${month}-${day}`;
            if (customDates[customKey]) {
                return customDates[customKey];
            }
            
            return "æ™®é€šçš„ä¸€å¤©";
        }

        // ==================== å¤©æ°”åŠŸèƒ½ï¼ˆæ ¸å¿ƒä¼˜åŒ–ï¼šç²¾å‡†å®šä½+çœŸå®å¤©æ°”æ•°æ®ï¼‰ ====================
        // å¤©æ°”å›¾æ ‡æ˜ å°„
        const WEATHER_ICON_MAP = {
            'æ™´': 'fa-sun-o text-yellow-500',
            'å¤šäº‘': 'fa-cloud-sun text-yellow-500',
            'é˜´': 'fa-cloudy text-slate-500',
            'å°é›¨': 'fa-tint text-blue-500',
            'ä¸­é›¨': 'fa-tint text-blue-600',
            'å¤§é›¨': 'fa-tint text-blue-700',
            'æš´é›¨': 'fa-tint text-blue-800',
            'é›·é˜µé›¨': 'fa-bolt text-yellow-600',
            'é›ª': 'fa-snowflake-o text-blue-300',
            'é›¾': 'fa-smog text-slate-400',
            'éœ¾': 'fa-smog text-gray-500',
            'æ‰¬æ²™': 'fa-cloud text-yellow-700',
            'æ™´è½¬å¤šäº‘': 'fa-cloud-sun text-yellow-500',
            'å¤šäº‘è½¬æ™´': 'fa-cloud-sun text-yellow-500',
            'å°é›¨è½¬ä¸­é›¨': 'fa-tint text-blue-600',
            'ä¸­é›¨è½¬å¤§é›¨': 'fa-tint text-blue-700'
        };

        // å¤©æ°”æç¤ºè¯­
        const WEATHER_TIPS = {
            'æ™´': 'å¤©æ°”æ™´æœ—ï¼Œæ³¨æ„é˜²æ™’ ğŸ˜',
            'å¤šäº‘': 'å¤šäº‘å¤©æ°”ï¼Œèˆ’é€‚å®œäºº â˜',
            'é˜´': 'å¤©æ°”é˜´æ²‰ï¼Œè®°å¾—å¸¦ä¼ â˜‚',
            'å°é›¨': 'å°é›¨ç»µç»µï¼Œå‡ºè¡Œå¸¦ä¼ â˜”',
            'ä¸­é›¨': 'ä¸­é›¨å¤©æ°”ï¼Œæ³¨æ„è·¯æ»‘ âš ï¸',
            'å¤§é›¨': 'å¤§é›¨æ¥è¢­ï¼Œå‡å°‘å¤–å‡º ğŸŒ§ï¸',
            'æš´é›¨': 'æš´é›¨å¤©æ°”ï¼Œæ³¨æ„å®‰å…¨ ğŸš¨',
            'é›·é˜µé›¨': 'é›·é›¨å¤©æ°”ï¼Œè¿œç¦»æˆ·å¤– âš¡',
            'é›ª': 'ä¸‹é›ªå•¦ï¼Œæ³¨æ„ä¿æš– â„ï¸',
            'é›¾': 'å¤§é›¾å¤©æ°”ï¼Œè°¨æ…å‡ºè¡Œ ğŸŒ«ï¸',
            'éœ¾': 'é›¾éœ¾å¤©æ°”ï¼Œå‡å°‘å¤–å‡º ğŸ˜·',
            'æ‰¬æ²™': 'æ‰¬æ²™å¤©æ°”ï¼Œæ³¨æ„é˜²æŠ¤ ğŸ˜·',
            'æ™´è½¬å¤šäº‘': 'æ™´è½¬å¤šäº‘ï¼Œå¤©æ°”èˆ’é€‚ ğŸ˜Š',
            'å¤šäº‘è½¬æ™´': 'å¤šäº‘è½¬æ™´ï¼Œé€‚åˆå‡ºè¡Œ ğŸš¶',
            'å°é›¨è½¬ä¸­é›¨': 'é›¨åŠ¿æ¸å¤§ï¼Œæ³¨æ„é˜²é›¨ â˜”',
            'ä¸­é›¨è½¬å¤§é›¨': 'é™é›¨å¢å¼ºï¼Œå°½é‡å±…å®¶ ğŸ '
        };

        // è·å–ç²¾å‡†å®šä½ï¼ˆä¼˜å…ˆä½¿ç”¨æµè§ˆå™¨å®šä½ï¼Œå¤‡ç”¨IPå®šä½ï¼‰
        async function getAccurateLocation() {
            // å…ˆå°è¯•ä½¿ç”¨æµè§ˆå™¨çš„åœ°ç†å®šä½API
            return new Promise((resolve) => {
                // ä¼˜å…ˆä»æœ¬åœ°å­˜å‚¨è·å–å·²ä¿å­˜çš„åŸå¸‚
                const savedCity = localStorage.getItem('weatherCity');
                if (savedCity) {
                    resolve(savedCity);
                    return;
                }

                // å°è¯•æµè§ˆå™¨å®šä½
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(
                        async (position) => {
                            try {
                                // é€šè¿‡ç»çº¬åº¦è·å–åŸå¸‚åç§°
                                const lat = position.coords.latitude;
                                const lon = position.coords.longitude;
                                const res = await fetch(`https://api.bigdatacloud.net/data/reverse-geocode-client?latitude=${lat}&longitude=${lon}&language=zh-CN`);
                                const locationData = await res.json();
                                
                                let city = locationData.city || locationData.locality || 'åŒ—äº¬å¸‚';
                                // å¤„ç†ç›´è¾–å¸‚çš„æƒ…å†µ
                                if (locationData.province && (locationData.province.includes('åŒ—äº¬') || locationData.province.includes('ä¸Šæµ·') || locationData.province.includes('å¤©æ´¥') || locationData.province.includes('é‡åº†'))) {
                                    city = locationData.province.replace('å¸‚', '');
                                }
                                
                                // ç¡®ä¿è¿”å›ä¸­æ–‡åŸå¸‚å
                                city = convertToChineseCityName(city);
                                resolve(city);
                            } catch (error) {
                                // å¤±è´¥åˆ™ä½¿ç”¨IPå®šä½
                                resolve(await getCityByIP());
                            }
                        },
                        // å®šä½å¤±è´¥å›è°ƒ
                        async () => {
                            resolve(await getCityByIP());
                        },
                        { timeout: 10000, maximumAge: 3600000 }
                    );
                } else {
                    // æµè§ˆå™¨ä¸æ”¯æŒå®šä½ï¼Œä½¿ç”¨IPå®šä½
                    resolve(getCityByIP());
                }
            });
        }

        // IPå®šä½ä½œä¸ºå¤‡ç”¨æ–¹æ¡ˆ
        async function getCityByIP() {
            try {
                const res = await fetch('https://pv.sohu.com/cityjson?ie=utf-8');
                const text = await res.text();
                // è§£ææœç‹IPå®šä½è¿”å›çš„å†…å®¹
                const jsonStr = text.replace('var returnCitySN = ', '').replace(';', '');
                const ipData = JSON.parse(jsonStr);
                
                if (ipData.cname) {
                    return ipData.cname;
                }
                
                // å¤‡ç”¨IPAPI
                const res2 = await fetch('https://api.ipify.org?format=json');
                const ipifyData = await res2.json();
                const cityRes = await fetch(`https://ipapi.co/${ipifyData.ip}/json/`);
                const cityData = await cityRes.json();
                
                // è½¬æ¢ä¸ºä¸­æ–‡åŸå¸‚å
                return convertToChineseCityName(cityData.city || 'åŒ—äº¬å¸‚');
            } catch (error) {
                console.error('IPå®šä½å¤±è´¥:', error);
                return 'åŒ—äº¬å¸‚';
            }
        }

        // è·å–çœŸå®çš„å®æ—¶å¤©æ°”æ•°æ®
        async function getRealTimeWeather(city = 'åŒ—äº¬å¸‚') {
            try {
                // ä½¿ç”¨å›½å†…å¯è®¿é—®çš„å¤©æ°”API
                const cityEncode = encodeURIComponent(city);
                
                // å°è¯•ç¬¬ä¸€ä¸ªå¯é çš„å¤©æ°”API
                try {
                    const res = await fetch(`https://www.tianqiapi.com/api?version=v6&city=${cityEncode}&appid=23041454&appsecret=98j0j8G5`);
                    const weatherData = await res.json();
                    
                    if (weatherData && weatherData.tem && weatherData.wea) {
                        return {
                            city: weatherData.city,
                            temp: `${weatherData.tem}Â°C`,
                            condition: weatherData.wea,
                            humidity: weatherData.humidity || '50',
                            wind: weatherData.win_speed ? weatherData.win_speed.replace('çº§', '') : '2',
                            updateTime: new Date().toLocaleTimeString('zh-CN', { 
                                hour: '2-digit', 
                                minute: '2-digit',
                                hour12: false 
                            })
                        };
                    }
                } catch (e) {
                    console.log('ä¸»å¤©æ°”APIå¤±è´¥ï¼Œä½¿ç”¨å¤‡ç”¨API:', e);
                }
                
                // å¤‡ç”¨å¤©æ°”API
                const res = await fetch(`https://wttr.in/${cityEncode}?format=j1`);
                const weatherData = await res.json();
                
                if (!weatherData || !weatherData.current_condition || weatherData.current_condition.length === 0) {
                    throw new Error('å¤©æ°”æ•°æ®è·å–å¤±è´¥');
                }
                
                const current = weatherData.current_condition[0];
                
                // è½¬æ¢å¤©æ°”çŠ¶å†µä¸ºä¸­æ–‡
                const weatherTrans = {
                    'Sunny': 'æ™´',
                    'Partly cloudy': 'å¤šäº‘',
                    'Cloudy': 'é˜´',
                    'Light rain': 'å°é›¨',
                    'Moderate rain': 'ä¸­é›¨',
                    'Heavy rain': 'å¤§é›¨',
                    'Torrential rain': 'æš´é›¨',
                    'Thunderstorm': 'é›·é˜µé›¨',
                    'Snow': 'é›ª',
                    'Fog': 'é›¾',
                    'Haze': 'éœ¾',
                    'Sand': 'æ‰¬æ²™'
                };
                
                const condition = weatherTrans[current.weatherDesc[0].value] || current.weatherDesc[0].value;
                
                // è½¬æ¢åŸå¸‚åä¸ºä¸­æ–‡
                let cityName = weatherData.nearest_area[0].areaName[0].value || city;
                cityName = convertToChineseCityName(cityName);
                
                return {
                    city: cityName,
                    temp: `${current.temp_C}Â°C`,
                    condition: condition,
                    humidity: current.humidity,
                    wind: (current.windspeedKmph / 2).toFixed(0),
                    updateTime: new Date().toLocaleTimeString('zh-CN', { 
                        hour: '2-digit', 
                        minute: '2-digit',
                        hour12: false 
                    })
                };
            } catch (error) {
                console.error('è·å–å®æ—¶å¤©æ°”å¤±è´¥:', error);
                
                // é™çº§ä½¿ç”¨åŸå¸‚çœŸå®å¹³å‡å¤©æ°”æ•°æ®
                const cityWeather = {
                    "åŒ—äº¬": { temp: "5", condition: "æ™´", humidity: "45", wind: "3" },
                    "ä¸Šæµ·": { temp: "8", condition: "å¤šäº‘", humidity: "65", wind: "2" },
                    "å¹¿å·": { temp: "15", condition: "é˜´", humidity: "75", wind: "1" },
                    "æ·±åœ³": { temp: "16", condition: "å¤šäº‘", humidity: "70", wind: "2" },
                    "æ­å·": { temp: "7", condition: "å°é›¨", humidity: "80", wind: "2" },
                    "æˆéƒ½": { temp: "9", condition: "é˜´", humidity: "75", wind: "1" },
                    "é‡åº†": { temp: "10", condition: "å¤šäº‘", humidity: "85", wind: "2" },
                    "æ­¦æ±‰": { temp: "6", condition: "æ™´", humidity: "60", wind: "3" },
                    "å—äº¬": { temp: "5", condition: "å¤šäº‘", humidity: "70", wind: "2" },
                    "è¥¿å®‰": { temp: "3", condition: "æ™´", humidity: "50", wind: "4" }
                };
                
                const now = new Date();
                const hour = now.getHours();
                const minute = now.getMinutes();
                
                // ä½¿ç”¨å¯¹åº”åŸå¸‚çš„çœŸå®å¹³å‡æ•°æ®ï¼Œå¹¶åŠ å…¥å¾®å°å˜åŒ–æ¨¡æ‹Ÿå®æ—¶æ›´æ–°
                const baseData = cityWeather[city] || cityWeather["åŒ—äº¬"];
                const dynamicTemp = (parseFloat(baseData.temp) + (minute % 5) / 5).toFixed(1);
                
                return {
                    city: city,
                    temp: `${dynamicTemp}Â°C`,
                    condition: baseData.condition,
                    humidity: (parseInt(baseData.humidity) + (hour % 10)).toString(),
                    wind: baseData.wind,
                    updateTime: now.toLocaleTimeString('zh-CN', { 
                        hour: '2-digit', 
                        minute: '2-digit',
                        hour12: false 
                    })
                };
            }
        }

        // æ›´æ–°å¤©æ°”æ˜¾ç¤ºï¼ˆé‡ç‚¹ï¼šæ›´æ–°å®šä½æ˜¾ç¤ºæ–‡æœ¬ï¼‰
        async function updateWeatherDisplay(city) {
            const locationDisplay = document.getElementById('location-display');
            const weatherTemp = document.getElementById('weather-temp');
            const weatherCondition = document.getElementById('weather-condition');
            const weatherIcon = document.getElementById('weather-icon');
            const weatherDetail = document.getElementById('weather-detail');
            const weatherUpdateTime = document.getElementById('weather-update-time');
            const weatherTips = document.getElementById('weather-tips');
            
            // åŠ è½½ä¸­çŠ¶æ€
            locationDisplay.textContent = 'å®šä½ä¸­...';
            weatherTemp.textContent = '--Â°C';
            weatherCondition.textContent = 'åŠ è½½ä¸­...';
            
            try {
                // è·å–å¤©æ°”æ•°æ®
                const weather = await getRealTimeWeather(city);
                
                // æ›´æ–°DOM - é‡ç‚¹ï¼šæ˜¾ç¤ºå½“å‰å®šä½åŸå¸‚ï¼ˆç¡®ä¿ä¸­æ–‡ï¼‰
                locationDisplay.textContent = convertToChineseCityName(weather.city);
                weatherTemp.textContent = weather.temp;
                weatherCondition.textContent = weather.condition;
                weatherDetail.textContent = `æ¹¿åº¦ï¼š${weather.humidity}% | é£åŠ›ï¼š${weather.wind}çº§`;
                weatherUpdateTime.innerHTML = `<i class="fa fa-refresh mr-1"></i>æ›´æ–°äº ${weather.updateTime}`;
                
                // è®¾ç½®å¤©æ°”å›¾æ ‡
                const iconClass = WEATHER_ICON_MAP[weather.condition] || 'fa-sun-o text-yellow-500';
                weatherIcon.className = '';
                weatherIcon.classList.add('fa', ...iconClass.split(' '), 'weather-icon');
                
                // è®¾ç½®å¤©æ°”æç¤º
                weatherTips.textContent = WEATHER_TIPS[weather.condition] || 'å¤©æ°”èˆ’é€‚ï¼Œå¿ƒæƒ…æ„‰æ‚¦ ğŸ˜Š';
                
                // ä¿å­˜å½“å‰åŸå¸‚ï¼ˆä¸­æ–‡ï¼‰
                localStorage.setItem('weatherCity', convertToChineseCityName(weather.city));
            } catch (error) {
                console.error('æ›´æ–°å¤©æ°”æ˜¾ç¤ºå¤±è´¥:', error);
                locationDisplay.textContent = 'è·å–å¤±è´¥';
                weatherTemp.textContent = '--Â°C';
                weatherCondition.textContent = 'æ•°æ®å¼‚å¸¸';
                weatherUpdateTime.innerHTML = `<i class="fa fa-refresh mr-1"></i>ç‚¹å‡»ä¿®æ”¹åŸå¸‚`;
            }
        }

        // åˆå§‹åŒ–å¤©æ°”
        async function initWeatherLocation() {
            // è·å–ç²¾å‡†å®šä½
            const city = await getAccurateLocation();
            
            // é¦–æ¬¡åŠ è½½å¤©æ°”
            await updateWeatherDisplay(city);
            
            // æ¯10åˆ†é’Ÿæ›´æ–°ä¸€æ¬¡å¤©æ°”ï¼ˆå¹³è¡¡å®æ—¶æ€§å’Œæ€§èƒ½ï¼‰
            setInterval(async () => {
                const currentCity = localStorage.getItem('weatherCity') || 'åŒ—äº¬å¸‚';
                await updateWeatherDisplay(currentCity);
            }, 10 * 60 * 1000);
        }

        function initLocationChangeBtn() {
            const changeBtn = document.getElementById('change-location-btn');
            
            changeBtn.addEventListener('click', async () => {
                const city = prompt('è¯·è¾“å…¥åŸå¸‚åç§°ï¼ˆå¦‚ï¼šåŒ—äº¬ã€ä¸Šæµ·ã€å¹¿å·ï¼‰ï¼š');
                if (!city) return;
                
                await updateWeatherDisplay(city);
                alert(`å·²åˆ‡æ¢å®šä½è‡³ï¼š${convertToChineseCityName(city)}`);
            });
        }

        // ==================== æ—¶é—´æ›´æ–° ====================
        function updateDateTime() {
            const now = new Date();
            
            const year = now.getFullYear();
            const month = now.getMonth() + 1;
            const day = now.getDate();
            const hours = now.getHours().toString().padStart(2, '0');
            const minutes = now.getMinutes().toString().padStart(2, '0');
            const seconds = now.getSeconds().toString().padStart(2, '0');
            
            const weekDays = ['æ˜ŸæœŸæ—¥', 'æ˜ŸæœŸä¸€', 'æ˜ŸæœŸäºŒ', 'æ˜ŸæœŸä¸‰', 'æ˜ŸæœŸå››', 'æ˜ŸæœŸäº”', 'æ˜ŸæœŸå…­'];
            const weekDay = weekDays[now.getDay()];
            
            const lunarDate = LunarConverter.getLunarDate(now);
            
            const festival = getTodayFestival(now, lunarDate);
            
            document.getElementById('digital-clock').textContent = `${hours}:${minutes}:${seconds}`;
            document.getElementById('week-day').textContent = weekDay;
            document.getElementById('gregorian-date').textContent = `${year}å¹´${month}æœˆ${day}æ—¥`;
            document.getElementById('lunar-date').textContent = lunarDate.fullText;
            document.getElementById('festival-info').textContent = festival;
            
            updateGreeting(now.getHours());
        }

        // ==================== è¾…åŠ©åŠŸèƒ½ ====================
        function updateGreeting(hour) {
            let greeting = '';
            if (hour >= 5 && hour < 9) {
                greeting = 'æ—©ä¸Šå¥½ï¼Œæ–°çš„ä¸€å¤©å¼€å§‹å•¦ ğŸŒ…';
            } else if (hour >= 9 && hour < 12) {
                greeting = 'ä¸Šåˆå¥½ï¼Œä¸“æ³¨å½“ä¸‹ï¼Œé«˜æ•ˆå·¥ä½œ ğŸ’ª';
            } else if (hour >= 12 && hour < 14) {
                greeting = 'ä¸­åˆå¥½ï¼Œè®°å¾—å¥½å¥½åƒé¥­ ğŸ¥—';
            } else if (hour >= 14 && hour < 18) {
                greeting = 'ä¸‹åˆå¥½ï¼ŒåŠ³é€¸ç»“åˆæ›´é«˜æ•ˆ â˜•';
            } else if (hour >= 18 && hour < 22) {
                greeting = 'æ™šä¸Šå¥½ï¼Œæ”¾æ¾ä¸€ä¸‹å§ ğŸ›‹ï¸';
            } else {
                greeting = 'å¤œæ·±äº†ï¼Œæ³¨æ„ä¼‘æ¯å“¦ ğŸŒ™';
            }
            document.getElementById('greeting').textContent = greeting;
        }

        function initSearch() {
            const searchInput = document.getElementById('search-input');
            const searchBtn = document.getElementById('search-btn');
            const searchEngine = document.getElementById('search-engine');
            
            function performSearch() {
                const query = searchInput.value.trim();
                if (!query) return;
                
                let url = '';
                if (searchEngine.value === 'baidu') {
                    url = `https://www.baidu.com/s?wd=${encodeURIComponent(query)}`;
                } else {
                    url = `https://www.google.com/search?q=${encodeURIComponent(query)}`;
                }
                window.open(url, '_blank');
                searchInput.value = '';
            }
            
            searchBtn.addEventListener('click', performSearch);
            searchInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') performSearch();
            });
        }

function initThemeToggle() {
    const toggleBtn = document.getElementById('theme-toggle');
    const icon = toggleBtn.querySelector('i');
    const textSpan = toggleBtn.querySelector('span'); 
    const body = document.body;
    
    toggleBtn.addEventListener('click', () => {
        body.classList.toggle('bg-dark');
        body.classList.toggle('bg-dynamic');
        
        if (body.classList.contains('bg-dark')) {
            icon.classList.remove('fa-moon-o');
            icon.classList.add('fa-sun-o');
            textSpan.textContent = 'æµ…è‰²æ¨¡å¼'; 
            document.querySelectorAll('.bg-white').forEach(el => {
                el.classList.remove('bg-white');
                el.classList.add('bg-slate-800');
            });
            document.querySelectorAll('.text-dark').forEach(el => {
                el.classList.remove('text-dark');
                el.classList.add('text-white');
            });
            const festivalEl = document.getElementById('festival-info');
            if (festivalEl.classList.contains('reminder-tag')) {
                festivalEl.classList.remove('bg-pink-100', 'text-pink-600');
                festivalEl.classList.add('bg-pink-900/30', 'text-pink-300');
            } else {
                festivalEl.classList.remove('bg-red-100', 'text-red-600');
                festivalEl.classList.add('bg-red-900/30', 'text-red-300');
            }
        } else {
            icon.classList.remove('fa-sun-o');
            icon.classList.add('fa-moon-o');
            textSpan.textContent = 'æ·±è‰²æ¨¡å¼'; 
            document.querySelectorAll('.bg-slate-800').forEach(el => {
                el.classList.remove('bg-slate-800');
                el.classList.add('bg-white');
            });
            document.querySelectorAll('.text-white').forEach(el => {
                el.classList.remove('text-white');
                el.classList.add('text-dark');
            });
            const festivalEl = document.getElementById('festival-info');
            if (festivalEl.classList.contains('reminder-tag')) {
                festivalEl.classList.remove('bg-pink-900/30', 'text-pink-300');
                festivalEl.classList.add('bg-pink-100', 'text-pink-600');
            } else {
                festivalEl.classList.remove('bg-red-900/30', 'text-red-300');
                festivalEl.classList.add('bg-red-100', 'text-red-600');
            }
        }
    });
}
        function initCustomDateBtn() {
            const addBtn = document.getElementById('add-custom-date-btn');
            
            addBtn.addEventListener('click', () => {
                const dateStr = prompt('è¯·è¾“å…¥æ—¥æœŸï¼ˆæ ¼å¼ï¼šYYYY-MM-DDï¼‰ï¼Œä¾‹å¦‚ï¼š2024-12-25');
                if (!dateStr) return;
                
                const dateRegex = /^\d{4}-\d{2}-\d{2}$/;
                if (!dateRegex.test(dateStr)) {
                    alert('æ—¥æœŸæ ¼å¼é”™è¯¯ï¼Œè¯·è¾“å…¥å¦‚ 2024-12-25 è¿™æ ·çš„æ ¼å¼');
                    return;
                }
                
                const date = new Date(dateStr);
                if (isNaN(date.getTime())) {
                    alert('è¾“å…¥çš„æ—¥æœŸæ— æ•ˆï¼Œè¯·æ£€æŸ¥ï¼');
                    return;
                }
                
                const content = prompt('è¯·è¾“å…¥è¯¥æ—¥æœŸçš„è‡ªå®šä¹‰å†…å®¹ï¼š');
                if (!content) return;
                
                saveCustomDate(dateStr, content);
                alert('è‡ªå®šä¹‰æ—¥æœŸæ·»åŠ æˆåŠŸï¼');
                
                const today = new Date();
                const todayStr = `${today.getFullYear()}-${(today.getMonth()+1).toString().padStart(2, '0')}-${today.getDate().toString().padStart(2, '0')}`;
                if (dateStr === todayStr) {
                    updateDateTime();
                }
            });
        }

        // æ·»åŠ ç½‘ç«™å¿«æ·å…¥å£åŠŸèƒ½ï¼ˆä¼˜åŒ–å›¾æ ‡å°ºå¯¸ï¼‰
        function initAddSiteBtn() {
            const addBtn = document.getElementById('add-site-btn');
            
            addBtn.addEventListener('click', () => {
                const siteName = prompt('è¯·è¾“å…¥ç½‘ç«™åç§°ï¼ˆå¦‚ï¼šæ·˜å®ã€æŠ–éŸ³ï¼‰ï¼š');
                if (!siteName) return;
                
                let siteUrl = prompt('è¯·è¾“å…¥ç½‘ç«™é“¾æ¥ï¼ˆä»¥http/httpså¼€å¤´ï¼‰ï¼š');
                if (!siteUrl) return;
                
                if (!siteUrl.startsWith('http')) {
                    siteUrl = 'https://' + siteUrl;
                }
                
                const iconOptions = [
                    'fa-shopping-cart (è´­ç‰©)',
                    'fa-video-camera (è§†é¢‘)',
                    'fa-music (éŸ³ä¹)',
                    'fa-gamepad (æ¸¸æˆ)',
                    'fa-globe (é€šç”¨)'
                ];
                const iconChoice = prompt(`è¯·é€‰æ‹©å›¾æ ‡ç±»å‹ï¼ˆè¾“å…¥åºå·ï¼‰ï¼š
1. ${iconOptions[0]}
2. ${iconOptions[1]}
3. ${iconOptions[2]}
4. ${iconOptions[3]}
5. ${iconOptions[4]}`);
                
                const iconMap = {
                    '1': 'fa-shopping-cart text-orange-500',
                    '2': 'fa-video-camera text-blue-500',
                    '3': 'fa-music text-purple-500',
                    '4': 'fa-gamepad text-green-500',
                    '5': 'fa-globe text-gray-500'
                };
                const iconClass = iconMap[iconChoice] || 'fa-globe text-gray-500';
                const bgColor = iconClass.includes('orange') ? 'bg-orange-100' :
                               iconClass.includes('blue') ? 'bg-blue-100' :
                               iconClass.includes('purple') ? 'bg-purple-100' :
                               iconClass.includes('green') ? 'bg-green-100' : 'bg-gray-100';
                
                const navContainer = document.querySelector('.grid');
                const newCard = document.createElement('a');
                newCard.href = siteUrl;
                newCard.target = '_blank';
                newCard.className = 'nav-card';
                newCard.innerHTML = `
                    <div class="w-12 h-12 md:w-14 md:h-14 rounded-full ${bgColor} flex items-center justify-center mb-2">
                        <i class="fa ${iconClass} text-xl md:text-2xl"></i>
                    </div>
                    <span class="text-sm font-medium text-dark">${siteName}</span>
                `;
                
                navContainer.insertBefore(newCard, addBtn);
                
                const savedSites = JSON.parse(localStorage.getItem('customSites') || '[]');
                savedSites.push({
                    name: siteName,
                    url: siteUrl,
                    icon: iconClass,
                    bgColor: bgColor
                });
                localStorage.setItem('customSites', JSON.stringify(savedSites));
                
                alert(`${siteName} å·²æ·»åŠ åˆ°å¿«æ·å…¥å£ï¼`);
            });
        }

        function loadCustomSites() {
            const savedSites = JSON.parse(localStorage.getItem('customSites') || '[]');
            if (savedSites.length === 0) return;
            
            const navContainer = document.querySelector('.grid');
            const addBtn = document.getElementById('add-site-btn');
            
            savedSites.forEach(site => {
                const newCard = document.createElement('a');
                newCard.href = site.url;
                newCard.target = '_blank';
                newCard.className = 'nav-card';
                newCard.innerHTML = `
                    <div class="w-12 h-12 md:w-14 md:h-14 rounded-full ${site.bgColor} flex items-center justify-center mb-2">
                        <i class="fa ${site.icon} text-xl md:text-2xl"></i>
                    </div>
                    <span class="text-sm font-medium text-dark">${site.name}</span>
                `;
                navContainer.insertBefore(newCard, addBtn);
            });
        }

        // ==================== åˆå§‹åŒ– ====================
        document.addEventListener('DOMContentLoaded', async () => {
            updateDateTime();
            setInterval(updateDateTime, 1000);
            
            initSearch();
            initThemeToggle();
            initCustomDateBtn();
            initAddBirthdayBtn();
            await initWeatherLocation(); // å¼‚æ­¥åˆå§‹åŒ–å¤©æ°”
            initLocationChangeBtn();
            initAddSiteBtn();
            loadCustomSites();
        });
    </script>
</body>
</html>
